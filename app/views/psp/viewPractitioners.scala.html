@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.FrontendAppConfig
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import uk.gov.hmrc.govukfrontend.views.html.components.{FormWithCSRF => PlayFrontendFormWithCSRF}
@import uk.gov.hmrc.hmrcfrontend.views.html.components.implicits._
@import uk.gov.hmrc.govukfrontend.views.html.components.implicits._
@import play.api.mvc.Call
@import viewmodels.AuthorisedPractitionerViewModel
@import controllers.psp.deauthorise.routes._
@import controllers.invitations.psp.routes._

@this(
layout: templates.Layout,
formHelper: PlayFrontendFormWithCSRF,
govukErrorSummary: GovukErrorSummary,
appConfig: FrontendAppConfig,
govukTable : GovukTable
)
@(
schemeName: String,
returnCall: Call,
practitioners: Seq[AuthorisedPractitionerViewModel]
)(
implicit
request: Request[_],
messages: Messages
)

@deauthorisedLink(pspName: String, index: Index, authorisedByLoggedInPsa:Boolean) = {

@if(authorisedByLoggedInPsa){
<a class="govuk-link" href="@ConfirmDeauthorisePspController.onPageLoad(index)">
        <span aria-hidden="true">
            @messages("messages__viewPractitioners__deAuthoriseLinkText")
        </span>
    <span class="govuk-visually-hidden">
            @messages("messages__viewPractitioners__deAuthoriseLinkText__hiddenText", pspName)
        </span>
</a>
} else{
                    <span class="govuk-visually-hidden">
                        @messages("messages__viewPractitioners__didNotAuthorise__hiddenText", pspName)
                    </span>
}

}

@layout(
pageTitle = s"${messages("messages__viewPractitioners__title")}"
) {







@govukTable(Table(
rows =
    for((practitioner, index) <- practitioners.zipWithIndex) yield {

Seq(
                TableRow(
                content = Text(practitioner.pspName)
                ),
                TableRow(
                content = Text(practitioner.authorisedBy)
                ),
                TableRow(
                content = Text(practitioner.dateAuthorised)
                ),

                TableRow(
                attributes = Map("id" -> "deAuthoriseLink-","role"-> "tabke"),
                content = HtmlContent(deauthorisedLink(practitioner.pspName,index,practitioner.authorisedByLoggedInPsa))
                )

)
    }
,
caption = Some("Month you apply")

))



<p class="govuk-body">
    <a id="authorise" class="govuk_link" href="@WhatYouWillNeedController.onPageLoad()">
        @messages("messages__pspAuthorise__link")
    </a>
</p>
<p class="govuk-body">
    <a id="return-link" class="govuk_link" href=@returnCall>
        @messages("site.return_to", schemeName)
    </a>
</p>
}